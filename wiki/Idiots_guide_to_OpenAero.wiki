=The Idiot's Guide to OpenAero=
==What is OpenAero?==
OpenAero is an aeroplane stabilising software for KK-type multicopter boards. You put the programmed KK board in between your receiver and the servos in your aircraft. When deactivated, OpenAero just passes the servo signals from your receiver to the servos. When activated, the gyros on your KK board are used to move the servos to counteract any unwanted movement of the aircraft.
==What does this guide cover?==
This guide covers only the basic versions of OpenAero. 
It does not cover versions with accelerometer or MEMS board add-ons for autoleveling.

==What versions of OpenAero are there?==
===Standard===
The standard PWM version of OpenAero has three stabilised outputs - Aileron, Elevator and Rudder.
For those needing a throttle control, you can just take the throttle output of your receiver directly to the ESC for your motor. The three-channel version of OpenAero provides finer control of servos.

The standard CPPM version of OpenAero has three stabilised outputs - Aileron, Elevator and Rudder, and outputs a copy of the throttle signal from the receiver out the THR pin of the KK board.

Read more about the differences between PWM and CPPM receivers elsewhere in this Wiki.
===Flying Wing===
Flying wings normally have delta/flaperon mixing done by the transmitter. This allows you to set the aileron/elevator mixing as best suits you and your aircraft.
When these signals pass through the OpenAero software the gyro stabilising has to accommodate the flying wing channel mixing. 
For instance, in response to pitch input, the standard version of Openaero would simply adjust the elevator servo. However the flying wing version adjusts both flaperons to have the desired effect.

The flying wing PWM version of OpenAero has three stabilised outputs - Left Flaperon, Right Flaperon and Rudder.

For those needing a throttle control, you can just take the throttle output of your receiver directly to the ESC for your motor. The three-channel version of OpenAero provides finer control of servos.

The flying wing CPPM version of OpenAero has three stabilised outputs - Left Flaperon, Right Flaperon and Rudder, and outputs a copy of the throttle signal from the receiver out the THR pin of the KK board.
===Flaperon===
The flaperon version of OpenAero is designed for conventional aeroplanes that have individually controlled ailerons.
The aileron channels normally have flap signals mixed with them so that both ailerons can be lowered to act as flaps, or raised to act as spoilers. Having separate aileron control also allows the use of aileron differential, where the upward movement of the ailerons is larger than the downward.

These models have the flaperon mixing done by the transmitter. This allows you to set flap positions and differential as best suits you and your aircraft.
When these signals pass through the OpenAero software the gyro stabilising has to accommodate the flaperon mixing. To accommodate this, the flaperon version of OpenAero has four stabilised outputs - Left Flaperon, Right Flaperon, Elevator and Rudder. A copy of the throttle signal from the receiver is also output from the THR pin of the KK board.

The flaperon version requires a single-wire CPPM receiver as there are not enough conventional PWM inputs to control the desired outputs.


===OpenAero Nano===
There is also a version called OpenAero Nano, which is a cut-down version of OpenAero designed to fit into the smallest KK boards with only 4K of program memory. 
You can read more about OpenAero Nano at the following link.

http://www.rcgroups.com/forums/showpost.php?p=20331503&postcount=2

==How do I connect up my model?==
===PWM receiver connections===
For a standard multi-wire PWM receiver you need to use the normal PWM inputs of the KK board. However, the THR input of the KK board has been repurposed to be the stability/autolevel switch input.

 * AIL: Aileron signal input (required)
 * ELE: Elevator signal input (optional)
 * THR: Stability switch input (required)
 * RUD: Rudder signal input (optional)

Please make careful note that for OpenAero to output servo signals, at least two inputs, including the stability switch input *MUST* be connected to the KK board.

Connect a switched input of your transmitter - normally the gear switch on channel 5 - to the Stability switch input.

Here is a diagram showing how to connect up a PWM receiver.
http://i.imgur.com/7jkPu.jpg

===CPPM receiver connections===
For a single-wire CPPM receiver you need to connect to the M3 output pin of the KK board. All the required signals including the stability/autolevel switch inputs are conveyed over this wire.

 * AIL: Unused
 * ELE: Unused
 * THR: Throttle output
 * RUD: Unused
 * M3:  CPPM signal input from receiver

Here is a diagram showing how to connect up a PWM receiver.
http://i.imgur.com/k2VAV.jpg

The CPPM versions require a receiver and a transmitter that can reallocate channels if not matching the JR/Spektrum channel order, or a CPPM converter board.
The OpenAero CPPM channel order is the same as the JR/Spektrum system:
 * CH1: Throttle
 * CH2: Aileron #1
 * CH3: Elevator
 * CH4: Rudder
 * CH5: Gear switch
 * CH6: Aileron #2
 * CH7: Aux 1
 * CH8: Aux 2
Note that the flaperon versions expect the second aileron channel to be found on Ch6.

===Servo connections===
For the standard version the connections are as follows:
 * M1: Rudder
 * M2: Aileron
 * M3: CPPM input (if used)
 * M4: Elevator
 * M5: Unused
 * M6: Unused
 * THR: Throttle (CPPM versions only)

For the flying wing version the connections are as follows:
 * M1: Rudder
 * M2: Left flaperon
 * M3: CPPM input (if used)
 * M4: Right flaperon
 * M5: Unused
 * M6: Unused
 * THR: Throttle (CPPM versions only)

For the flaperon wing version the connections are as follows:
 * M1: Rudder
 * M2: Left flaperon
 * M3: CPPM input (if used)
 * M4: Elevator
 * M5: Right flaperon
 * M6: Unused
 * THR: Throttle (CPPM versions only)

===Extra connections===
*Low battery alarm*

If you have a KK Plus board, OpenAero supports the detection of battery voltage via the attached power distribution pads.

*Buzzer/LED outputs*

If you have a KK Plus board, OpenAero supports the use of a piezo buzzer via the buzzer connections and LEDs via the LED driver pads.
The buzzer can be used as the audible signal for the lost model alarm or to signal that the battery voltage has dropped below the preset point.

==How do I set up OpenAero?==
===Pot positions and their use===


===Initial setup and calibration===
The first time you set up OpenAero you will have to adjust a few things to suit your radio gear and particular usage. While everything is adjustable via the LCD interface, for the moment we will just go over the most common ones that everyone can use.

*Trimming your model*

For OpenAero to understand the normal trimmed radio settings, you have to ask it to learn the trimmed position.
Firstly though, your model has to be completely trimmed when OpenAero stability is OFF.
To be sure OpenAero stability is off, with the model powered up, move the model about and see if the control surfaces move. If so, stability is ON and you have to correct that before proceeding. Change the input that controls stability to the opposite state to switch off stability.
Now adjust all flying surfaces to the neutral position with all trims centered. Please adjust the mechanical servo connections and finally the computer-controlled trims in the transmitter until the model is trimmed.

*Stick centering*

To get OpenAero to learn the neutral stick position, all you have to do is power up the model (with transmitter on) while the Yaw pot is set to the correct position. 
Different boards have the pot polarity reversed so there is no hard rule to determine which direction (clockwise or couter-clockwise) to turn the yaw pot.
What we need to do is set the Yaw pot to the minimum value. Turn the pot with a small screwdriver until it hits the stop in the minimum direction.
Power up the model and watch the LED on the KK board carefully.
If the Yaw pot is set to the correct position, the LED should blink rapidly five times then one long flash. If so the stick position has been successfully saved.
If the Yaw pot is set to the wrong position, the LED will blink about 12-13 times. Power off the model, reverse the Yaw pot and try again.
Once the stick position has been successfully saved, switch off ans please remember to return the Yaw pot to the center of its travel.

===Every time you power up OpenAero===



*GUI*
Have made a new GUI version similar to that of the NeXtcopter project but with proper aeroplane mode and all the copter stuff removed.
In non-stabilised mode the board just passes the RC values through to the servos and in stability mode the board uses the gyros to dampen any unwanted rotation. Autolevel mode will direct the model back to whatever level position you set up when the accelerometer is calibrated, and trimmed on the field via the LCD or GUI.
For conventional PWM receivers (via four cables) I have updated the code so that you are able to select Autolevel mode and/or Stability mode via the former throttle input. The default is for that channel to just switch stability on and off with Autolevel disabled, but you can configure the switch via either power-on stick positions or LCD to also switch in Autolevel as well and/or leave stability on permanently if desired.

Here's a shot of the new V0.2 GUI for the OpenAero. This example shows a model in Flaperon mode (two stabilised servos per wing). 
[IMG]http://i.imgur.com/hSHbl.jpg[/IMG]

[SIZE="3"][B]Features[/B][/SIZE]
Depending on what type of KK board, and which add-ons you have fitted to them, these are the available features.

- Support for Standard, Flying Wing and Flaperon-equipped models
- Auto arming
- Switchable stability mode
- LCD support for setting flight parameters
- GUI for setting parameters and visualising sensors and stability 
- LCD Menu selectable features
[INDENT]P + I gain
LVA voltage *
LVA alarm mode *
Battery voltage readout
Stick centering
Gyro reversing
Servo reversing
Stability switch function
Autolevel switch function[/INDENT]
- Lost model alarm*
- In CPPM mode the throttle signal is decoded and passed back out via the THR pin to be connected to an ESC + motor
- Vertical board orientation compile option 
- Flying Wing mode
- Stick centering on power-up via Yaw pot
- Adjustable gain via pots or LCD based on a preset - defaults to pots
[INDENT]Roll pot will adjust Roll and Pitch gain (P-term)
Pitch pot will adjust Roll and Pitch I-term
Yaw pot will adjust Yaw gain (P-term) I-term adjustable via LCD or GUI[/INDENT]
 - Gyro direction can be reversed by setting the Roll pot to zero and using the TX sticks
- Support for CPPM receivers
- Switchable auto-level mode 
- Additional Menu selectable features
[INDENT]Accelerometer pitch and roll trim 
Autolevel Gyro and Acc P + I gain
Accelerometer calibration[/INDENT]

* Needs KK+ board

[B]What do I need to get the GUI running?[/B]
You need a MKUSB-type serial interface for the GUI to communicate to the board.
Because of the limitations of the KK board, a non-standard cable is required.

The connections you need are as follows:
[B]For an 8-pin header[/B]
From: KK+         To: MKUSB X3 port (Note X3 port [B]NOT[/B] X2 port)
Pin 8 receive      Pin 8 transmit
Pin 9 transmit     Pin 3 receive
Pin 10 ground     Pin 10 ground
Pin 2   +5V        Pin 2   +5V

[B]..but I don't have an 8-pin header on my KK board[/B]
The 6-pin connector is missing the serial RXD signal that the KK+ has. It goes to pin 30 of the CPU. Looking at my Blackboard, that pin is not connected at all. Unless you are super-keen to solder a fine wire to pin 30 and make up a hybrid cable, you're out of luck with a Blackboard. However, if sufficiently motivated, here's the connections you'd need.
Note that on the HobbyKing boards, there is a test pad connected to this pin, making it much easier to access.

[B]For an 6-pin header[/B]
From: 6-pin KK To: MKUSB X3 port
Pin X RXD Pin 8 transmit
Pin 1 MISO to Pin 3 receive
Pin 6 Ground to Pin 10 ground
Pin 2 +5V to Pin 2 +5V

* Pin X goes to pin 30 of the Atmel CPU.

Here is a shot of my very simple serial cable for 8-pin KK+ boards.
[IMG]http://i.imgur.com/MFTP5.jpg[/IMG]


[B]Servo connections - V1.11[/B]
Standard/Flying Wing
M1: Rudder
M2: Reversed rudder
M3: Aileron/Left flaperon
M4: Reversed aileron
M5: Elevator/Right flaperon
M6: Reversed elevator/Reversed right flaperon

[B][COLOR="Red"]Servo connections - V1.12[/COLOR][/B]
Standard/Flying Wing/Flaperon
M1: Rudder
M2: Aileron/Left flaperon
M3: CPPM input only - not a servo output
M4: Elevator/Right flaperon (FW)/Elevator
M5: Right flaperon(non-FW)
M6: Spare

[B]Connection diagram - CPPM Aeroplane V1.10/V1.11[/B]
[IMG]http://i.imgur.com/nLa3V.jpg[/IMG]

[B]Connection diagram - STD Aeroplane V1.10/V1.11[/B]
[IMG]http://i.imgur.com/zn6Lt.jpg[/IMG]

[B]Connection diagram - [COLOR="Red"]CPPM Aeroplane V1.12[/COLOR][/B]
[IMG]http://i.imgur.com/k2VAV.jpg[/IMG]

[B]Connection diagram - [COLOR="Red"]STD Aeroplane V1.12[/COLOR][/B]
[IMG]http://i.imgur.com/7jkPu.jpg[/IMG]

[B]Pot-based power-up settings guide[/B]
Stick Centering
 1. Set Yaw Gain pot to max 
 2. Set Tx trims to centre
 3. Power on
 4. LED flashes 3 times
 5. Restore gain pot
 6. Restart

AutoTune
 1. Set Yaw Gain pot to min
 2. Start KK autotune on GUI
 3. Power on
 4. LED flashes 12-13 times
 5. Restore gain pot
 6. Restart

Gyro reversing (Note: Only for versions without an accelerometer)
 1. Set Roll Gain pot to zero
 2. Power on
 3. LED flashes 6 times
 4. Move relevant stick Up/Left for Normal, Down/Right for reverse
 5. Restore pot
 6. Restart

[B]Transmitter-based power-up settings guide[/B]
Manual stability mode selection. This switches between Stability switchable (default) and Stability always on.

 1. Hold Yaw stick on TX left or right
 2. Power on FC
 3. LED flashes 4 times
 4. Return stick to neutral

Manual Autolevel mode selection. This switches between Autolevel switchable and Stability always off (default).

 1. Hold Roll stick on TX left or right
 2. Power on FC
 3. LED flashes 5 times
 4. Return stick to neutral

[B]Videos[/B]
This is mrfliboy's test flight of the V1.10 beta firmware
[URL="http://www.youtube.com/watch?v=mDF0NxXTDO4"]http://www.youtube.com/watch?v=mDF0NxXTDO4[/URL]

Here's a video I found on YouTube on a guy using V1.11 on a Bixler.
[URL="http://youtu.be/hLFenZskyyc"]http://youtu.be/hLFenZskyyc[/URL]

A really cool video from Brazil showing a model battling strong wind
[URL="http://www.youtube.com/watch?v=m24TntjX-G4"]http://www.youtube.com/watch?v=m24TntjX-G4[/URL]

Here's a video that NDw made of his first flight of the code:
[URL="http://vimeo.com/34564560"]http://vimeo.com/34564560[/URL]

Here's a great video of eyeinsky1 flying his FPV model in aeroplane mode
[URL="http://www.youtube.com/watch?v=lj9eEkSe80M"]http://www.youtube.com/watch?v=lj9eEkSe80M[/URL]

Here's a quick look at the LCD menu and GUI
[URL="http://www.youtube.com/watch?v=nPP8HNMnuxo"]http://www.youtube.com/watch?v=nPP8HNMnuxo[/URL]

[B]Code change log[/B]
[B]V1.10a (beta)[/B]
Updates:
 - Added lost model alarm. Alarm (if fitted) will sound one minute after the last RC activity.
 - Changed GUI lockout system. You must connect to the GUI within 10 seconds of power-on. The GUI is locked out after this time until repowered.
 - LCD menu entry is now with Pitch UP, Yaw RIGHT *and* Roll LEFT for added security.
 - Added configurable stability and autolevel switch modes. Now users with normal PWM receivers can switch both Stability and Autolevel (if fitted).
 - Fixed cycle timer in GUI to display actual loop cycle time :)

[B]V1.11 (beta)[/B]
Updates:
 - Added flaperon configuration for split ailerons on M3/M4
 - Fixed stick centering via Yaw pot.

[B]V1.12[/B]
Updates:
 - New output pulse generation code. Three and six-channel modes. 
 - Removed reversed channels.
 - Added ICP input option for CPPM mode. 
 - Fixed flaperon and vertical mode bugs.

[B]Common issues[/B]
1. Any functions that need the transmitter sticks to navigate (LCD Menu and Gyro reversing) will not work if your transmitter has flaperon mixing or similar. You need to have individual control of each channel. You can then switch the mixing back on to fly.
2. Make sure the transmitter travel throws are set to at least 100%, otherwise the stick-based settings won't work. Examples include LCD menu navigation and gyro reversing. 

The .hex files were tested on a standard KK 5.5 Blackboard, a HK V2 and a KK+.

[B]Which .hex file do I need?[/B]

1. Unmodified HobbyKing V2, Blackboard or KK+ (Atmega168-based)
[COLOR="Blue"]OpenAero_1_11_A_PWM_STD.hex[/COLOR] for standard PWM receivers (Aeroplane)
[COLOR="Blue"]OpenAero_1_11_FW_PWM_STD.hex[/COLOR] for standard PWM receivers (Flying Wing)
[COLOR="Blue"]OpenAero_1_11_A_CPPM_STD.hex[/COLOR] for CPPM receivers (Aeroplane)
[COLOR="Blue"]OpenAero_1_11_FW_CPPM_STD.hex[/COLOR] for CPPM  receivers (Flying Wing)
These versions use the on-board pots to adjust P and I-terms for Roll and Pitch, and Yaw P-term.

2. HobbyKing V2, Blackboard or KK+ (Atmega168-based) with an accelerometer board
[COLOR="Blue"]OpenAero_1_11_A_PWM_ACC.hex[/COLOR] for standard PWM receivers (Aeroplane)
[COLOR="Blue"]OpenAero_1_11_FW_PWM_ACC.hex[/COLOR] for standard PWM receivers (Flying Wing)
[COLOR="Blue"]OpenAero_1_11_A_CPPM_ACC.hex[/COLOR] for CPPM receivers (Aeroplane)
[COLOR="Blue"]OpenAero_1_11_FW_CPPM_ACC.hex[/COLOR] for CPPM  receivers (Flying Wing)
These versions cannot use pot-based gain control so required either LCD or GUI for setup and adjustment.

3. KK+ with a MEMS module (better gyros and accelerometer)
[COLOR="Blue"]OpenAero_1_11_A_PWM_MEMS.hex[/COLOR] for standard PWM receivers (Aeroplane)
[COLOR="Blue"]OpenAero_1_11_FW_PWM_MEMS.hex[/COLOR] for standard PWM receivers (Flying Wing)
[COLOR="Blue"]OpenAero_1_11_A_CPPM_MEMS.hex[/COLOR] for CPPM receivers (Aeroplane)
[COLOR="Blue"]OpenAero_1_11_FW_CPPM_MEMS.hex[/COLOR] for CPPM  receivers (Flying Wing)
These versions cannot use pot-based gain control so required either LCD or GUI for setup and adjustment.

4. New experimental version for flaperon/split ailerons on M3 and M4
[COLOR="Blue"]OpenAero_1_11_FPN_CPPM_MEMS.hex[/COLOR] for CPPM receivers and a KK+ with MEMS module
[COLOR="Blue"]OpenAero_1_11_FPN_CPPM_STD.hex[/COLOR] for CPPM  receivers and a standard KK board

Note that CPPM versions require a receiver and a transmitter that can reallocate channels if not matching the JR/Spektrum channel order, or a CPPM converter board.
The OpenAero CPPM channel order is the same as the JR/Spektrum system: [B]Throttle, Aileron, Elevator, Rudder, 5, 6, 7, 8[/B]
The flaperon versions expect the second aileron channel to be found on Ch6.

[COLOR="Blue"]OpenAeroGUI_V0_1a4.zip[/COLOR] = Windows 32-bit GUI files















#summary One-sentence summary of this page.

= Introduction =

Add your content here.


= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages